{% extends "nav_est.html" %}
{% load static %}

{% block titulo %} Dashboard de Resultados del Estudiante {% endblock %}

{% block contenido %}
<div class="container-fluid p-4">
    <div class="row">
        <!-- Contenedor Izquierdo -->
        <div class="col-md-8 d-flex flex-column gap-3">
            <div class="card text-center border-0 rounded" style="background-color: #57CC99; border-radius: 30px;">
                <div class="card-body">
                    <h5 class="card-title" style="font-size: 1.5rem; font-weight: bold; color: #FFFFFF;">Informaci√≥n General</h5>
                    <p class="card-text" style="font-size: 1.1rem; color: #E1F5FE;">Detalles sobre tu rendimiento general en los ex√°menes.</p>
                </div>
            </div>
            <div class="container-fluid p-0">
                <div class="row">
                    <!-- Gr√°fica de Dona -->
                    <div class="col-md-7 d-flex flex-column gap-0">
                        <div class="card text-center border-0 rounded" style="background-color: rgba(255, 255, 255, 0.9); border-radius: 30px;">
                            <div class="card-body">
                                <h5 class="card-title" style="font-size: 1.5rem; font-weight: bold; color: #22577A;">Rendimiento de Ex√°menes üìä</h5>
                                <div class="chart-container" style="position: relative; height: 250px; width: 100%; margin: 0 auto;">
                                    <canvas id="doughnutChart"></canvas>
                                    <div class="chart-percentage" id="chartPercentage" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2.2rem; font-weight: bold; color: #22577A; border-radius: 50%; padding: 10px; background-color: rgba(255, 255, 255, 0.7); border: 2px solid #22577A;">75%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contenedor para las tarjetas de Aprobados y Reprobados -->
                    <div class="col-md-5 d-flex flex-column gap-3">
                        <div class="card text-center border-0 rounded" style="border: 2px solid #80ED99; border-radius: 30px;">
                            <div class="card-body">
                                <h5 class="card-title" style="font-size: 1.5rem; font-weight: bold; color: #22577A;"><i class="bi bi-check-circle"></i> Aprobados ‚úÖ</h5>
                                <p class="card-text" style="font-size: 2rem; font-weight: bold; color: #22577A;">{{ total_approved|floatformat:0 }}</p>
                            </div>
                        </div>
                        <div class="card text-center border-0 rounded" style="border: 2px solid #C7F9CC; border-radius: 30px;">
                            <div class="card-body">
                                <h5 class="card-title" style="font-size: 1.5rem; font-weight: bold; color: #22577A;"><i class="bi bi-x-circle"></i> Reprobados ‚ùå</h5>
                                <p class="card-text" style="font-size: 2rem; font-weight: bold; color: #22577A;">{{ total_failed|floatformat:0 }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Contenedor Derecho -->
        <div class="col-md-4 d-flex flex-column gap-3">
            <div class="card text-center border-0 rounded" style="background-color: rgba(255, 255, 255, 0.9); border-radius: 30px;">
                <div class="card-body">
                    <h5 class="card-title" style="font-size: 1.5rem; font-weight: bold; color: #22577A;"><i class="bi bi-list-check"></i> Total de Ex√°menes</h5>
                    <p class="card-text" style="font-size: 2rem; font-weight: bold; color: #22577A;">{{ total_exams|floatformat:0 }}</p>
                </div>
            </div>
            <div class="card text-center border-0 rounded" style="background-color: rgba(255, 255, 255, 0.9); border-radius: 30px;">
                <div class="card-body">
                    <h5 class="card-title" style="font-size: 1.5rem; font-weight: bold; color: #22577A;"><i class="bi bi-bar-chart-line"></i> Promedio de Puntaje</h5>
                    <p class="card-text" style="font-size: 2rem; font-weight: bold; color: #22577A;">{{ average_score|floatformat:0 }}%</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bot√≥n para descargar el PDF -->
    <div class="row mt-3">
        <div class="col text-center">
            <!-- Bot√≥n para generar PDF -->
            <form method="get" action="{% url 'resultStu' %}">
                <input type="hidden" name="generate_pdf" value="true">
                <button type="submit" class="btn btn-success btn-lg">Generar PDF</button>
            </form>
        </div>
    </div>

</div>

<!-- Scripts para la Gr√°fica -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Gr√°fica de Dona
    var ctxDoughnut = document.getElementById('doughnutChart').getContext('2d');
    var doughnutChart = new Chart(ctxDoughnut, {
        type: 'doughnut',
        data: {
            labels: ['Aprobados', 'Reprobados'],
            datasets: [{
                data: [{{ total_approved|default:0 }}, {{ total_failed|default:0 }}],
                backgroundColor: [ '#38A3A5', '#F44336'], // Color de la gr√°fica: rojo y un tono claro
                hoverBackgroundColor: ['#22577A', '#D32F2F'], // Colores al pasar el mouse
                borderColor: '#fff',
                borderWidth: 3, // Ancho del borde
                hoverBorderWidth: 5, // Ancho del borde al pasar el mouse
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%', // Espacio vac√≠o en el medio
            plugins: {
                legend: {
                    display: false // Ocultar leyenda
                }
            }
        }
    });

    // Actualiza el porcentaje en el centro de la gr√°fica
    var total = {{ total_approved|default:0 }} + {{ total_failed|default:0 }};
    if (total > 0) {
        var percentage = (({{ total_approved|default:0 }} / total) * 100).toFixed(0);
        document.getElementById('chartPercentage').innerText = percentage + '%';
    } else {
        document.getElementById('chartPercentage').innerText = '0%';
    }
</script>
{% endblock %}
