{% extends "nav.html" %}
{% load static %}
{% block titulo %} Dashboard de Cursos {% endblock %}
{% block contenido %}
<div class="container-fluid" style="padding-top: 0; margin-top: 0;">
    <!-- Bienvenida -->
    <div class="row mb-3">
        <div class="col-md-12">
            <div class="card shadow-sm text-center" style="background-color: #38A3A5; color: white;">
                <div class="card-body">
                    <h5 class="card-title">Bienvenido al Dashboard de Cursos</h5>
                    <p class="card-text">Gestiona cursos y visualiza estadísticas importantes.</p>
                    <a href="{% url 'create_course' %}" class="btn btn-light btn-lg">
                        <i class="fas fa-book-plus"></i> Agregar Curso
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección de Gráficos y Cursos -->
    <div class="row">
        <!-- Estadísticas de Cursos -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header" style="background-color: #22577A; color: white;">
                    <h5><i class="fas fa-chart-bar"></i> Estadísticas de Cursos</h5>
                </div>
                <div class="card-body" style="height: 200px;">
                    <canvas id="courseStatsChart" height="180"></canvas>
                </div>
            </div>
        </div>

        <!-- Acordeón de Cursos -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header" style="background-color: #80ED99; color: white;">
                    <h5><i class="fas fa-book"></i> Cursos</h5>
                </div>
                <div class="card-body" style="max-height: 300px; overflow-y: auto; scrollbar-width: thin; scrollbar-color: #38A3A5 #f0f0f0;">
                    <!-- Input para filtro -->
                    <input type="text" id="courseFilter" class="form-control mb-3" placeholder="Filtrar por nombre de curso">

                    <!-- Acordeón de cursos -->
                    <div class="accordion" id="courseAccordion">
                        {% for cour in courses %}
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="heading{{ cour.id }}">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ cour.id }}" aria-expanded="true" aria-controls="collapse{{ cour.id }}">
                                    {{ cour.nomCourse }}
                                </button>
                            </h2>
                            <div id="collapse{{ cour.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ cour.id }}" data-bs-parent="#courseAccordion">
                                <div class="accordion-body">
                                    <strong>Id:</strong> {{ cour.id }}<br>
                                    <strong>Cantidad de Estudiantes:</strong> {{ cour.numStudents }}<br>
                                    <div class="mt-3">
                                        <a class="btn btn-info btn-sm" href="{% url 'update_course' cour.id %}">
                                            <i class="fas fa-edit"></i> Actualizar
                                        </a>
                                        <a class="btn btn-danger btn-sm" href="{% url 'delete_course' cour.id %}">
                                            <i class="fas fa-trash-alt"></i> Eliminar
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección Adicional (Resumen General) -->
    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm border-0">
                <div class="card-header" style="background-color: #57CC99; color: white;">
                    <h5><i class="fas fa-book-open"></i> Total de Cursos</h5>
                </div>
                <div class="card-body text-center">
                    <h2 class="display-4">{{ courses.count }}</h2>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Script para el gráfico -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var ctx = document.getElementById('courseStatsChart').getContext('2d');
    var courseStatsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: [
                {% for cour in courses %}
                '{{ cour.nomCourse }}'{% if not forloop.last %},{% endif %}
                {% endfor %}
            ],
            datasets: [{
                label: 'Cantidad de Estudiantes',
                data: [
                    {% for cour in courses %}
                    {{ cour.numStudents }}{% if not forloop.last %},{% endif %}
                    {% endfor %}
                ],
                backgroundColor: [
                    'rgba(225, 119, 122, 0.8)',
                    'rgba(128, 237, 153, 0.8)',
                    'rgba(56, 163, 165, 0.8)',
                    'rgba(199, 249, 204, 0.8)'
                ],
                borderColor: [
                    '#22577A',
                    '#80ED99',
                    '#38A3A5',
                    '#C7F9CC'
                ],
                borderWidth: 1
            }]
        },
        options: {
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });

    // Filtro por nombre de curso
    document.getElementById('courseFilter').addEventListener('input', function () {
        var filterValue = this.value.toLowerCase();
        var accordions = document.querySelectorAll('.accordion-item');

        accordions.forEach(function(item) {
            var header = item.querySelector('.accordion-button');
            var body = item.querySelector('.accordion-body');
            var name = header.textContent.toLowerCase();

            if (name.includes(filterValue)) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    });
</script>

<style>
    /* Estilos para el scroll */
    .accordion-body::-webkit-scrollbar {
        width: 10px;
    }

    .accordion-body::-webkit-scrollbar-track {
        background: #f0f0f0; /* Color del fondo del scroll */
    }

    .accordion-body::-webkit-scrollbar-thumb {
        background-color: #38A3A5; /* Color del scroll */
        border-radius: 10px; /* Bordes redondeados */
    }

    .accordion-body::-webkit-scrollbar-thumb:hover {
        background-color: #2e7c7b; /* Color al pasar el ratón */
    }

    /* Estilos para el texto del dashboard */
    h5, .card-title, .card-text {
        font-family: 'Roboto', sans-serif; /* Asegúrate de que la fuente coincida con la del navbar */
        font-size: 16px; /* Ajusta el tamaño según lo necesites */
    }
</style>

{% endblock %}
